{
    "collab_server" : "",
    "contents" : "library(shiny)\nsource(\"global.R\")\n\nshinyServer(\n  function(input, output) {\n    \n    output$text5 <- renderTable({\n      #select price table by weekday\n      if (input$weekday == 7){\n        data <- boxSun\n      } else if (input$weekday == 5){\n        data <- boxFri\n      } else if (input$weekday == 6){\n        data <- boxSat\n      } else {\n        data <- boxMTWT\n      }\n      #select boxsize by numbers of people\n      if (input$range == 1 | input$range == 2|input$range == 3){\n        boxprice = data[,2]\n        boxn <- colnames(data[2])\n      } else if (input$range == 4 |input$range ==5 | input$range ==6){\n        boxprice = data[,3]\n        boxn <- colnames(data[3])\n      } else if (input$range == 7 |input$range ==8 | input$range ==9){\n        boxprice = data[,4]\n        boxn <- colnames(data[4])\n      } else if (input$range == 10 |input$range ==11 | input$range ==12){\n        boxprice = data[,5]\n        boxn <- colnames(data[5])\n      } else if (input$range == 13 |input$range ==14 | input$range ==15){\n        boxprice = data[,6]\n        boxn <- colnames(data[6])\n      } else if (input$range == 16 |input$range ==17 | input$range ==18){\n        boxprice = data[,8]\n        boxn <- colnames(data[8])\n      } else {\n        boxprice = data[,9]\n        boxn <- colnames(data[9])\n      }\n      branchname <- as.data.frame(boxMTWT[,1])\n      boxprice <- as.data.frame(boxprice)\n      boxprice = cbind(boxprice, branchname)\n      colnames(boxprice)[2] <- \"branch\"\n      \n      start <- as.numeric(input$start)\n      start <- start + 10\n      end   <- as.numeric(input$end)\n      end   <- end + 10\n    \n      #for (i in 1:ncol(boxprice))\n      #{\n      #  boxprice = boxprice[ !is.na(boxprice[,i]),] \n      #  colnames(boxprice)[2] <- \"branch\"\n      #}\n        \n      if (start < end){\n        timeprice = data[,start:end]\n        timeprice$trsum <- rowSums(timeprice)\n        timeprice = cbind(boxprice,timeprice,data[,34:36])\n        for (j in 1:ncol(timeprice)) {\n          timeprice = timeprice [ !is.na(timeprice[,j]),]\n        }\n      } else if (start > end){\n        temps = data[,start:33]\n        tempe = data[,10:end]\n        timeprice = cbind(temps,tempe)\n        timeprice$trsum <- rowSums(timeprice)\n        timeprice = cbind(boxprice,timeprice,data[,34:36])\n        for (j in 1:ncol(timeprice)){\n          timeprice = timeprice [ !is.na(timeprice[,j]),]\n        }\n      } else {\n        timeprice = data[,10:33]\n        timeprice$trsum <- rowSums(timeprice)\n        timeprice = as.data.frame(timeprice)%>%\n          cbind(boxprice,.)\n        timeprice = cbind(timeprice,data[,34:36])\n        timeprice = na.omit(timeprice)\n      }\n      #calculation\n      \n      discount <- 1\n      \n      temptable <- mutate(timeprice, boxtotal = boxprice*trsum) \n      temptable <- mutate(temptable, boxavg = (boxtotal/input$range)*discount)\n      temptable$whichbox <- boxn\n      \n      \n      if (temptable$store[1]==\"好樂迪\"){\n        temptable <- mutate(temptable, avgn = (boxavg + 100)*1.1 ) %>%\n          mutate(., avgfb = (boxavg +158)*1.1 )\n        a <- as.data.frame(temptable$store)\n        colnames(a) <- \"KTV\"\n        b <- as.data.frame(temptable$branch)\n        colnames(b) <- \"分店\"\n        c <- as.data.frame(temptable$whichbox)\n        colnames(c) <- \"建議包廂類型\"\n        d <- as.data.frame(temptable$avgn)\n        f <- as.data.frame(temptable$phone)\n        colnames(f) <- \"電話\"\n        g <- as.data.frame(temptable$address)\n        colnames(g) <- \"地址\"\n        e <- as.data.frame(temptable$avgfb)\n        colnames(e) <- \"每人平均(歡樂吧)\"\n        finaltable <- cbind(a,b,c,d,e,f,g)%>%\n          arrange(., temptable$avgn)\n        names(finaltable)[names(finaltable)==\"temptable$avgn\"]=\"每人平均(一般)\"\n      } else if(temptable$store[1]==\"錢櫃\"){\n        temptable <- mutate(temptable, avg = (boxavg + 99)*1.1)\n        a <- as.data.frame(temptable$store)\n        colnames(a) <- \"KTV\"\n        b <- as.data.frame(temptable$branch)\n        colnames(b) <- \"分店\"\n        c <- as.data.frame(temptable$whichbox)\n        colnames(c) <- \"建議包廂類型\"\n        d <- as.data.frame(temptable$avg)\n        colnames(d) <- \"每人平均\"\n        f <- as.data.frame(temptable$phone)\n        colnames(f) <- \"電話\"\n        g <- as.data.frame(temptable$address)\n        colnames(g) <- \"地址\"\n        finaltable <- cbind(a,b,c,d)\n      } else {\n        finaltable = temptable\n      }\n      \n      finaltable\n      \n    })\n    \n    \n  }\n)",
    "created" : 1483260023655.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1357796043",
    "id" : "480E59A9",
    "lastKnownWriteTime" : 1483674937,
    "last_content_update" : 1483674937292,
    "path" : "C:/Users/acer/Desktop/KTVcaculator/testKTVcalculator/server.R",
    "project_path" : "server.R",
    "properties" : {
        "source_window_id" : ""
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}